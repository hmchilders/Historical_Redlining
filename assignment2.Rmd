---
title: 'EDS 223: assignment 2'
author: "{student name and collaborators}"
output: html_document
date: "2023-10-17"
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(include = TRUE, message = FALSE, warning = FALSE)
```

## Assignment

### Investigate the legacy of redlining in current environmental (in)justice

Load relevant packages.

```{r }
library(tidyverse)
library(sf)
library(tmap)
library(tmaptools)
library(leaflet)
```

Read in EJScreen data and filter to Los Angeles County (5 points)

```{r }
ejscreen <- st_read("~/Documents/MEDS/Courses/EDS223/Assignment2/assignment-2-hmchilders/data/EJSCREEN_2023_BG_StatePct_with_AS_CNMI_GU_VI.gdb/")
```

Make a map of wastewater discharge by census block groups. Indicate
which census block groups are above the 95th percentile of national
values for wastewater discharge by adding a centroid. (10 points)

```{r }
LA <- ejscreen %>%
  filter(CNTY_NAME %in% c("Los Angeles County"))
LA_95 <- LA %>% 
  filter(P_PWDIS > 95)

tm_shape(LA)+
  tm_fill(fill = 'P_PWDIS',
          fill.scale = tm_scale(breaks = c(0,20,40,60,80,90,95,100)),
          fill.legend = tm_legend(title = 'Percentiles'))+
  tm_shape(LA_95)+
  tm_symbols(size = 0.1,
             col = "red")+
  tm_graticules()
  
```

Find the percent of census block groups that have:\
- less than 5% of the population is considered low income (5 points)

```{r }
top_5_income <- LA %>% 
  filter(LOWINCPCT < 0.05)

pct_top <- (length(top_5_income$LOWINCPCT)/length(LA$LOWINCPCT))*100
pct_top


```

Find the percent of census block groups that are:\
- above the 80th percentile for Particulate Matter 2.5 AND\
- above the 80th percentile for Superfund proximity (10 points)

```{r }
pctl_80 <- LA %>% 
  filter(P_PM25 > 80 & P_PNPL > 80)

pct_above_80 <- (nrow(pctl_80)/nrow(LA))*100

pct_above_80

```

Import redlining information for Los Angeles.

```{r }
LA_redlining <- st_read("https://dsl.richmond.edu/panorama/redlining/static/downloads/geojson/CALosAngeles1939.geojson") %>%
  st_make_valid()

```

Make a map of historical redlining boundaries, colored by HOLC grade. (5
points)

```{r }
  tm_shape(LA_redlining)+
  tm_polygons('holc_grade',
          palette = c("chartreuse", "darkturquoise", "gold1", "firebrick2") )+
    tm_fill(legend. )
            tm_graticules()

```

Find the number of census block groups that fall within areas with HOLC
grades hint: make sure the CRS match (15 points)

```{r eval=FALSE}
# I checked the CRS matching by printing the variable name for each of the two datasets, since they did not match, I will have to match them as shown below:
#st_crs(LA)
#st_crs(LA_redlining)

class(LA_redlining)
LA_transform <- st_transform(LA_redlining, crs = 3857)
st_crs(LA_transform)

```

Summarize current conditions based on EJScreen data within historical
redlining categories using the mean of the following variables:\
-% low income.\
- percentile for particulate Matter 2.5.\
- percentile for low life expectancy.\
- percentile for air toxics cancer risk (20 points)

```{r }
joined_mapping <- st_intersection(LA_transform, LA)

nrow(LA_transform)

Summ_stats <- joined_mapping %>%
  st_drop_geometry() %>% 
  group_by(holc_grade) %>% 
  summarize(avg_pct_LowIncome = mean(LOWINCPCT, na.rm = TRUE),
            avg_pctl_PM25 = mean(P_PM25, na.rm = TRUE),
            avg_pctl_LifeExpt = mean(P_LIFEEXPPCT, na.rm = TRUE),
            avg_pctl_Cancer = mean(P_CANCER, na.rm = TRUE))
Summ_stats


```

Please write 2-3 sentences reflecting on these results. (5 points)

### Investigate the legacy of redlining in biodiversity observations

For bird observations from 2022 that fall within neighborhoods with HOLC
grades, find the percent of observations within each redlining
categories and plot results. hint: make sure that the bird observations
have the same CRS as redlining data. (20 points)

```{r}
bird_data <- st_read("~/Documents/MEDS/Courses/EDS223/Assignment2/assignment-2-hmchilders/data/gbif-birds-LA/")


```

```{r}
birds <- bird_data %>% 
  filter(year == "2022")

joined_birds <- st_join(LA_redlining,birds)
```

```{r}
grade_pct <- joined_birds %>% 
  group_by(holc_grade) %>% 
  summarize(obsv_pct = ((n()/nrow(joined_birds))*100))

ggplot(grade_pct, aes(x = holc_grade, y = obsv_pct))+
  geom_col(fill = c("chartreuse", "darkturquoise", "gold1", "firebrick2"))+
  labs(x = "HOLC Grades",
       y = "Precent of observation")
```

```{r}
#optional graph
id_pct <-joined_birds %>% 
  group_by(holc_id) %>% 
  summarize(obs_pct = ((n()/nrow(joined_birds))*100))

tm_shape(LA_redlining)+
  tm_fill('holc_grade', 
          palette = c("chartreuse", "darkturquoise", "gold1", "firebrick2" ))+
  tm_shape(id_pct)+
  tm_symbols('obs_pct')
```

Please write 2-3 sentences reflecting on these results. Are they
surprising? If so, why? What are some potential implications? (5 points)
